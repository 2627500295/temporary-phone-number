<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>

  <script type="text/javascript">
    function isSupportNotification() {
      return "Notification" in window;
    }

    function isGrantedPermission() {
      return Notification.permission === 'granted';
    }

    function isDeniedPermission() {
      return Notification.permission === 'denied';
    }

    function isDefaultPermission() {
      return Notification.permission === 'default';
    }

    function getIntlPhoneNumber(phoneNumber) {
      return `+${phoneNumber}`
    }

    function sendNotification({title, ...options}) {
      return new Notification(title, options)
    }

    function appendMessage({phoneNumber, from, content}) {
      const message = document.createElement('li');
      message.innerText = `from: ${from}; to: ${phoneNumber}; message: ${content};`;
      document.body.appendChild(message);
    }

    /** @param event {MessageEvent} - Event */
    async function handleMessageEvent(event) {
      const data = JSON.parse(event.data);

      if (isGrantedPermission()) {
        sendNotification({
          title: getIntlPhoneNumber(data.from),
          body: data.content,
          renotify: true,
          tag: 'sms'
        });
      }

      appendMessage(data);
    }

    // (async function bootstrap() {
    //   if (isDefaultPermission()) {
    //     await Notification.requestPermission();
    //   }
    //
    //   const eventSource = new EventSource('http://127.0.0.1:8080/messages/17207277520');
    //   eventSource.addEventListener("message", handleMessageEvent);
    // })();



    function signIn() {
      if (opener) {
        // opener.postMessage({}, location.origin);
        console.log("--->>>", "open");
        opener.postMessage({source: 'auth'}, location.origin);

        return;
      }
      //
      // if (opened) return;

      const width = Math.min(500, screen.width - 40);
      const height = Math.min(550, screen.height - 40);
      const top = screen.height / 2 - height / 2;
      const left = screen.width / 2 - width / 2;

      const features = Object.entries({
        toolbar: 'no',
        location: 'no',
        directories: 'no',
        status: 'no',
        menubar: 'no',
        scrollbars: 'no',
        resizable: 'no',
        copyhistory: 'no',
        width,
        height,
        top,
        left,
      })
        .map(([key, value]) => `${key}=${value}`)
        .join(',');

      window.opened = open(location.href, '_auth_window', features);
    }

    function messageListener(event) {
      if (event.data.hello) return;
      console.log(event);
    }

    window.addEventListener("message", messageListener);
  </script>
</head>
<body>
  <div>111</div>

  <button onclick="signIn()">open</button>
</body>
</html>